# =============================================================================
# Dracula Colors
# =============================================================================
$background  = rgb(282a36)
$currentline = rgb(44475a)
$foreground  = rgb(f8f8f2)
$comment     = rgb(6272a4)
$cyan        = rgb(8be9fd)
$green       = rgb(50fa7b)
$orange      = rgb(ffb86c)
$pink        = rgb(ff79c6)
$purple      = rgb(bd93f9)
$red         = rgb(ff5555)
$yellow      = rgb(f1fa8c)

# =============================================================================
# Variables
# =============================================================================
$mod = SUPER

# =============================================================================
# Environment
# =============================================================================
env = XCURSOR_THEME,Adwaita
env = XCURSOR_SIZE,24
env = HYPRCURSOR_SIZE,24
env = HYPRCURSOR_THEME,Adwaita
env = GTK_THEME,Adwaita:dark
env = GDK_SCALE,1.5
env = QT_AUTO_SCREEN_SCALE_FACTOR,1
env = QT_QPA_PLATFORM,wayland
env = SDL_VIDEODRIVER,wayland
env = MOZ_ENABLE_WAYLAND,1
env = ELECTRON_OZONE_PLATFORM_HINT,wayland
env = OZONE_PLATFORM,wayland
env = GDK_BACKEND,wayland

# =============================================================================
# Startup
# =============================================================================
exec-once = dbus-update-activation-environment --systemd --all
exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP XDG_SESSION_TYPE XDG_RUNTIME_DIR HYPRLAND_INSTANCE_SIGNATURE XDG_SESSION_DESKTOP

# Clipboard history
exec-once = wl-paste --type text --watch cliphist store
exec-once = wl-paste --type image --watch cliphist store

# Idle management
exec-once = hypridle

# Blue light filter
exec-once = hyprsunset

# Clipboard persistence
exec-once = wl-clip-persist --clipboard regular & clipse -listen

# =============================================================================
# Monitor (Framework 13" 2256x1504)
# =============================================================================
monitor = eDP-1, 2256x1504@60, auto, 1.566667

# =============================================================================
# XWayland (sharp rendering at fractional scale)
# =============================================================================
xwayland {
    force_zero_scaling = true
}

# =============================================================================
# Input
# =============================================================================
input {
    kb_layout = us
    follow_mouse = 1
    sensitivity = 0

    touchpad {
        natural_scroll = true
        tap-to-click = true
        drag_lock = true
    }
}

gesture = 4, horizontal, workspace

# =============================================================================
# General
# =============================================================================
general {
    gaps_in = 4
    gaps_out = 8
    border_size = 3
    col.active_border = $purple $pink 45deg
    col.inactive_border = $currentline
    layout = dwindle
    allow_tearing = false
    resize_on_border = true
}

dwindle {
    pseudotile = true
    preserve_split = true
}

# =============================================================================
# Decoration
# =============================================================================
decoration {
    rounding = 8

    blur {
        enabled = true
        size = 5
        passes = 3
        new_optimizations = true
        xray = true
    }

    shadow {
        enabled = true
        range = 15
        render_power = 3
        color = $background
    }
}

# =============================================================================
# Animations
# =============================================================================
animations {
    enabled = true

    bezier = snap, 0.2, 1.0, 0.3, 1.0
    bezier = liner, 1, 1, 1, 1

    animation = windows, 1, 2, snap, slide
    animation = windowsIn, 1, 2, snap, slide
    animation = windowsOut, 1, 2, snap, slide
    animation = windowsMove, 1, 2, snap, slide
    animation = border, 1, 1, liner
    animation = borderangle, 1, 30, liner, loop
    animation = fade, 1, 3, default
    animation = workspaces, 1, 3, snap
    animation = specialWorkspace, 1, 3, snap, slidevert
}

# =============================================================================
# Misc
# =============================================================================
misc {
    disable_hyprland_logo = true
    disable_splash_rendering = true
    force_default_wallpaper = 0
    focus_on_activate = true
}

ecosystem {
    no_update_news = true
}

# =============================================================================
# Window Rules
# =============================================================================
windowrule = float on, match:class ^(1Password)$
windowrule = float on, match:title ^(Picture-in-Picture)$
windowrule = pin on, match:title ^(Picture-in-Picture)$

# Screen-share indicator (auto-hide to special workspace)
$shareIndicator = match:title ^(.*)(is sharing (your screen|a window).*)$
windowrule = no_focus on, $shareIndicator
windowrule = workspace special:share silent, $shareIndicator

# Google Meet PIP
$meetPip = match:title ^(Meet - .+)$
windowrule = float on, $meetPip
windowrule = pin on, $meetPip
windowrule = size 320 540, $meetPip
windowrule = move 100%-340 60, $meetPip

# Workspace assignments
windowrule = workspace 2 silent, match:class ^(google-chrome)$
windowrule = workspace 3 silent, match:class ^(Slack)$

# Settings management (float for audio/bluetooth GUIs)
windowrule = float on, match:class ^(org.pulseaudio.pavucontrol|.blueman-manager-wrapped|blueman-manager)$

# Clipse clipboard manager (float centered)
windowrule = float on, match:class ^(clipse)$
windowrule = size 622 652, match:class ^(clipse)$
windowrule = stay_focused on, match:class ^(clipse)$

# Suppress maximize for all windows
windowrule = suppress_event maximize, match:class .*

# Ghostty slight opacity for visual depth
windowrule = opacity 0.95 0.90, match:class ^(com.mitchellh.ghostty)$

# Ghostty scratchpad
windowrule = workspace special:scratchpad silent, match:class ^(ghostty-scratchpad)$
windowrule = float on, match:class ^(ghostty-scratchpad)$
windowrule = size 90% 70%, match:class ^(ghostty-scratchpad)$
windowrule = center on, match:class ^(ghostty-scratchpad)$

# =============================================================================
# Layer Rules
# =============================================================================
# Blur for walker
layerrule = blur on, match:namespace ^(walker)$
layerrule = ignore_alpha on, match:namespace ^(walker)$
layerrule = animation slide top, match:namespace ^(walker)$

# =============================================================================
# App Launch Hotkeys (Super + letter)
# =============================================================================
bind = $mod, T, exec, ghostty
bind = $mod, G, exec, hyprctl clients -j | grep -q '"class": "google-chrome"' && hyprctl dispatch focuswindow class:google-chrome || google-chrome-stable
bind = $mod, S, exec, hyprctl clients -j | grep -q '"class": "Slack"' && hyprctl dispatch focuswindow class:Slack || slack
bind = $mod, C, exec, cursor
bind = $mod, P, exec, gtk-launch 1password
bind = $mod, M, exec, gtk-launch signal-desktop
bind = $mod, N, exec, ghostty -e yazi

# =============================================================================
# System GUIs (WiFi / Bluetooth / Audio)
# =============================================================================
bind = $mod, I, exec, hyprpanel toggleWindow network-menu
bind = $mod, B, exec, blueman-manager
bind = $mod, A, exec, pavucontrol

# =============================================================================
# Launcher & Clipboard
# =============================================================================
bind = CTRL ALT SHIFT, SPACE, exec, walker
bind = $mod, V, exec, code
bind = $mod, E, exec, emote

# =============================================================================
# Window Management
# =============================================================================
bind = $mod, W, killactive,
bind = $mod, F, togglefloating,
bind = CTRL ALT SHIFT, F, exec, hyprctl --batch "dispatch movetoworkspace empty; dispatch fullscreen 0"
bind = SUPER CTRL, F, fullscreen, 0
bind = $mod SHIFT, Q, exec, hyprpanel toggleWindow power-menu
bind = $mod, TAB, hyprexpo:expo, toggle

# Focus (vim keys)
bind = $mod, H, movefocus, l
bind = $mod, L, movefocus, r
bind = $mod, K, movefocus, u
bind = $mod, J, movefocus, d

# Focus (arrow keys)
bind = $mod, left, movefocus, l
bind = $mod, right, movefocus, r
bind = $mod, up, movefocus, u
bind = $mod, down, movefocus, d

# Move windows (vim keys)
bind = $mod SHIFT, H, movewindow, l
bind = $mod SHIFT, L, movewindow, r
bind = $mod SHIFT, K, movewindow, u
bind = $mod SHIFT, J, movewindow, d

# Move windows (arrow keys)
bind = $mod SHIFT, left, movewindow, l
bind = $mod SHIFT, right, movewindow, r
bind = $mod SHIFT, up, movewindow, u
bind = $mod SHIFT, down, movewindow, d

# Resize windows
binde = $mod CTRL, left, resizeactive, -20 0
binde = $mod CTRL, right, resizeactive, 20 0
binde = $mod CTRL, up, resizeactive, 0 -20
binde = $mod CTRL, down, resizeactive, 0 20

# =============================================================================
# Workspaces
# =============================================================================
bind = $mod, 1, workspace, 1
bind = $mod, 2, workspace, 2
bind = $mod, 3, workspace, 3
bind = $mod, 4, workspace, 4
bind = $mod, 5, workspace, 5
bind = $mod, 6, workspace, 6
bind = $mod, 7, workspace, 7
bind = $mod, 8, workspace, 8
bind = $mod, 9, workspace, 9

bind = $mod SHIFT, 1, movetoworkspace, 1
bind = $mod SHIFT, 2, movetoworkspace, 2
bind = $mod SHIFT, 3, movetoworkspace, 3
bind = $mod SHIFT, 4, movetoworkspace, 4
bind = $mod SHIFT, 5, movetoworkspace, 5
bind = $mod SHIFT, 6, movetoworkspace, 6
bind = $mod SHIFT, 7, movetoworkspace, 7
bind = $mod SHIFT, 8, movetoworkspace, 8
bind = $mod SHIFT, 9, movetoworkspace, 9

# Scroll through workspaces
bind = $mod, mouse_down, workspace, e+1
bind = $mod, mouse_up, workspace, e-1

# Switch workspaces with Ctrl+Arrow (macOS-style)
bind = CTRL, left, workspace, e-1
bind = CTRL, right, workspace, e+1

# Mouse window management
bindm = $mod, mouse:272, movewindow
bindm = $mod, mouse:273, resizewindow

# =============================================================================
# Scratchpad & Recording
# =============================================================================
bind = $mod CTRL, T, exec, ~/.config/hypr/scripts/toggle-terminal.sh
bind = $mod SHIFT, R, exec, ~/.config/hypr/scripts/record-screen.sh

# Quick previous-window toggle (like macOS Cmd+`)
bind = $mod, GRAVE, focuscurrentorlast

# =============================================================================
# Screenshot (grim+slurp+swappy for annotated, hyprshot for quick)
# =============================================================================
bind = $mod SHIFT, S, exec, grim -g "$(slurp)" - | swappy -f -
bind = , PRINT, exec, hyprshot -m region
bind = SHIFT, PRINT, exec, hyprshot -m window
bind = CTRL, PRINT, exec, hyprshot -m output

# Color picker
bind = $mod, PRINT, exec, hyprpicker -a

# Clipboard manager (clipse)
bind = CTRL $mod, V, exec, ghostty --class clipse -e clipse

# =============================================================================
# Media / Hardware Keys (Framework 13 AI 300)
# =============================================================================
# F1: Mute speaker
bindl = , XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindl = , F1, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
# F2: Volume down
bindel = , XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bindel = , F2, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
# F3: Volume up
bindel = , XF86AudioRaiseVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+
bindel = , F3, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+
# F4: Previous track
bindl = , XF86AudioPrev, exec, playerctl previous
bindl = , F4, exec, playerctl previous
# F5: Next track
bindl = , XF86AudioNext, exec, playerctl next
bindl = , F5, exec, playerctl next
# F6: Play/pause
bindl = , XF86AudioPlay, exec, playerctl play-pause
bindl = , XF86AudioPause, exec, playerctl play-pause
bindl = , F6, exec, playerctl play-pause
# F7: Brightness down
bindel = , XF86MonBrightnessDown, exec, brightnessctl set 5%-
bindel = , F7, exec, brightnessctl set 5%-
# F8: Brightness up
bindel = , XF86MonBrightnessUp, exec, brightnessctl set 5%+
bindel = , F8, exec, brightnessctl set 5%+
# F9: Toggle display scale (1.0x <-> 1.567x)
bindl = , XF86Display, exec, hyprctl -j monitors | jq -r '.[0].scale' | awk '{if($1>1.3) print "1.0"; else print "1.566667"}' | xargs -I{} hyprctl keyword monitor "eDP-1,preferred,auto,{}"
bindl = , F9, exec, hyprctl -j monitors | jq -r '.[0].scale' | awk '{if($1>1.3) print "1.0"; else print "1.566667"}' | xargs -I{} hyprctl keyword monitor "eDP-1,preferred,auto,{}"
# F10: Airplane mode
bindl = , XF86RFKill, exec, nmcli radio wifi toggle
bindl = , F10, exec, nmcli radio wifi toggle
# F11: Print screen (full output via hyprshot)
bind = , F11, exec, hyprshot -m output

# =============================================================================
# Display Zoom (Framework + / - , macOS-style)
# =============================================================================
# Keyd maps Framework+= / Framework+- to Ctrl+Alt+Shift+= / Ctrl+Alt+Shift+-
# Valid scales for 2256x1504: 1.0, 1.333333, 1.566667, 2.0
binde = CTRL ALT SHIFT, equal, exec, hyprctl -j monitors | jq -r '.[0].scale' | awk '{s=$1; if(s<1.16) s=1.333333; else if(s<1.45) s=1.566667; else if(s<1.78) s=2.0; else s=2.0; printf "%.6f",s}' | xargs -I{} hyprctl keyword monitor "eDP-1,preferred,auto,{}"
binde = CTRL ALT SHIFT, minus, exec, hyprctl -j monitors | jq -r '.[0].scale' | awk '{s=$1; if(s>1.78) s=1.566667; else if(s>1.45) s=1.333333; else if(s>1.16) s=1.0; else s=1.0; printf "%.6f",s}' | xargs -I{} hyprctl keyword monitor "eDP-1,preferred,auto,{}"

# =============================================================================
# Lock Screen
# =============================================================================
bind = $mod CTRL, L, exec, hyprlock

# =============================================================================
# Notification Toggle
# =============================================================================
bind = $mod SHIFT, D, exec, hyprpanel toggleWindow notifications-center

# =============================================================================
# Plugins
# =============================================================================
plugin {
    hyprexpo {
        columns = 3
        gap_size = 5
        bg_col = rgb(282a36)
        workspace_method = first 1
        gesture_fingers = 3
        gesture_distance = 300
        gesture_positive = false
    }
}
